[tool.poetry]
name = "astronomer-starship"
version = "1.2.0"
description = "Migrations to Astro"
authors = ["CSE Team <cse@astronomer.io>"]
readme = "README.rst"
repository = "https://github.com/astronomer/starship"
homepage = "https://astronomer.io"
license = "Proprietary"
packages = [{include = "astronomer_starship"}]
include = [
  "astronomer_starship/starship/templates/*",
  "astronomer_starship/starship/static/*",
  "astronomer_starship/starship/aeroscope/plugins/templates/*"
]

#[tool.setuptools]
#package-dir = {"" = "astronomer"}
#
#[tool.setuptools.packages.find]
#where = ["astronomer"]

[tool.poetry.dependencies]
python = ">=3.7.2,<4.0"
pydash = "^7"
python-graphql-client = "^0"
requests = "^2"
cachetools = "<6,>=4"
pyjwt = ">=1"

[tool.poetry.group.orion.dependencies]
click = "^8.1.3"
halo = "^0.0.31"
fs = "^2.4.16"

[tool.poetry.group.dev.dependencies]
pytest = "^7.2.1"
pytest-cov = "^4.0.0"
pytest-integration = "^0.2.3"
pytest-mock = "^3.10.0"
mock-alchemy = "^0"
black = "^23.1.0"
requests = "^2.28.2"
twine = "^4.0.2"
ruff = "^0.0.261"
pylint = {version = "^2.17.2", python = ">=3.8.1"}
pyupgrade = "^3.3.1"
pyyaml = "^6.0"
pulumi = "^3.63.0"
pulumi-aws = "^5.35.0"
apache-airflow = "<2.6"
isort = {version = "^5.12.0", python = ">=3.8.1"}
python-dotenv = {version = "^1.0.0", python = ">=3.8.1"}
sh = {version = "^2.0.4", python = ">=3.8.1"}
pre-commit = {version = "^3.3.3", python = ">=3.8.1"}
toml = {version = "^0.10.2", python = "<3.11"}
docker = "^6.1.3"
detect-secrets = "^1.4.0"
pytest-sugar = "^0.9.7"

[tool.poetry.group.aws.dependencies]
boto3 = "^1.26.81"
boto3-stubs = {extras = ["mwaa", "s3"], version = "^1.26.81"}
fs-s3fs = "^1.1.1"

#[tool.poetry.scripts]
# Entry points for the package https://python-poetry.org/docs/pyproject/#scripts
#orion = "orion.__main__:migrate"

# dynamically add plugin to Airflow Plugins
[tool.poetry.plugins] # Optional super table
[tool.poetry.plugins."airflow.plugins"]
"starship" = "astronomer_starship.starship.main:StarshipPlugin"
"starship_aeroscope" = "astronomer_starship.aeroscope.plugins:AeroscopePlugin"

# for pip installing this pyproject.toml
[project.entry-points."airflow.plugins"]
"starship" = "astronomer_starship.starship.main:StarshipPlugin"
"starship_aeroscope" = "astronomer_starship.aeroscope.plugins:AeroscopePlugin"

[project.entry-points.apache_airflow_provider]
provider_info = "astronomer_starship.starship.__init__:get_provider_info"


[build-system]
requires = ["poetry-core>=1.0.8"]
build-backend = "poetry.core.masonry.api"

[tool.black]
# https://github.com/psf/black
color = true

[tool.bandit]
exclude_dirs = ["tests"]
skips = [
  "B301",
  "B403",
  "B310",  # urlopen in Aeroscope
  "B608"  # SQL Injection in DAG History Migration
]

[tool.ruff]
line-length = 120

[tool.rstcheck]
report_level = "WARNING"

[tool.pytest.ini_options]
# https://docs.pytest.org/en/6.2.x/customize.html#pyproject-toml
# Directories that are not visited by pytest collector:
norecursedirs =["tests/resources/", "hooks", "*.egg", ".eggs", "dist", "build", "docs", ".tox", ".git", "__pycache__"]
doctest_optionflags = ["NUMBER", "NORMALIZE_WHITESPACE", "IGNORE_EXCEPTION_DETAIL"]

# Extra options:
addopts = [
#  "--ignore=tests/resources/example-dag.py",
#  "--ignore=resources/fix.py",
  "--strict-markers",
  "--tb=short",
  "--disable-warnings",
  "--no-header",
  "--doctest-modules",
  "--doctest-continue-on-failure",
]
